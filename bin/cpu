#!/bin/sh

# CPU line courtesy Procyon:
# https://bbs.archlinux.org/viewtopic.php?pid=874333#p874333
function cpu {
    read cpu a b c previdle rest < /proc/stat
    prevtotal=$((a+b+c+previdle))
    sleep 0.5
    read cpu a b c idle rest < /proc/stat
    total=$((a+b+c+idle))
    cpu="$((100*( (total-prevtotal) - (idle-previdle) ) / (total-prevtotal) ))"
    echo "$cpu%"
}

cpu

#previous_total=0
#previous_stats=(0 0 0 0)
#
# while :
# do
#current_total=0
#    read -a current_stats < <(awk '/^cpu /{print $2" "$3" "$4" "$5}' /proc/stat)
#    for n in ${current_stats[@]}; do ((current_total+=$n)); done
#    sleep 2
#    ((idle=${current_stats[3]}-${previous_stats[3]}))
#    ((total=current_total-previous_total))
#    ((cpu=100*(total-idle)/total))
#    previous_stats=(${current_stats[@]})
#    previous_total=$current_total
#    echo "$cpu%"
#done

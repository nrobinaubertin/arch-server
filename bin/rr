#!/bin/bash

# TODO
# usage function
# empty trash
# errors when emptying trash : there can be some files without write rights

# stop if something goes wrong
set -e

# nounce to avoid duplicate files in the trash in the same swipe
nounce=0

# timestamp to avoid duplicates over multiple swipes
timestamp=$(date +%s)

if (( $# == 0 ))
then
    echo "Missing file operand." 1>&2
    exit 1
fi

if [[ "$1" == "--size" ]]
then
    du -hs "$HOME/.trash" | cut -f1;
    exit 0
fi

if [[ "$1" == "--empty" ]]
then
    rm -rf "${HOME}/.trash"
fi

function sendToTrash {

    if ! [[ -e "$1" ]]
    then
        echo "$1 does not exists. Aborting."
        exit 0;
    fi

    # create the trash directory
    mkdir -p "$HOME/.trash"

    if ! [ -d "$HOME/.trash" ]
    then
       echo "$HOME/.trash directory could not be created" 1>&2
       exit 1
    fi

    nounce=$(( nounce + 1 ))
    filename=${1%/}
    target="${filename##*/}.${nounce}.${timestamp}"

    mv -T "$filename" "$HOME/.trash/$target"
    
    if (( $# > 1 ))
    then
        sendToTrash "${@:2}"
    fi
}

sendToTrash "${@:1}"

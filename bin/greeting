#!/bin/sh

# TODO
# accelerate ip route show (find another way to do it if possible)
# use colors effectively
# enhance display of storage
# count packages in a non-arch way
# remove fortune ?

RCol='\e[0m'    # Text Reset

# Regular           Bold                Underline           High Intensity      BoldHigh Intens     Background          High Intensity Backgrounds
Bla='\e[0;30m';     BBla='\e[1;30m';    UBla='\e[4;30m';    IBla='\e[0;90m';    BIBla='\e[1;90m';   On_Bla='\e[40m';    On_IBla='\e[0;100m';
Red='\e[0;31m';     BRed='\e[1;31m';    URed='\e[4;31m';    IRed='\e[0;91m';    BIRed='\e[1;91m';   On_Red='\e[41m';    On_IRed='\e[0;101m';
Gre='\e[0;32m';     BGre='\e[1;32m';    UGre='\e[4;32m';    IGre='\e[0;92m';    BIGre='\e[1;92m';   On_Gre='\e[42m';    On_IGre='\e[0;102m';
Yel='\e[0;33m';     BYel='\e[1;33m';    UYel='\e[4;33m';    IYel='\e[0;93m';    BIYel='\e[1;93m';   On_Yel='\e[43m';    On_IYel='\e[0;103m';
Blu='\e[0;34m';     BBlu='\e[1;34m';    UBlu='\e[4;34m';    IBlu='\e[0;94m';    BIBlu='\e[1;94m';   On_Blu='\e[44m';    On_IBlu='\e[0;104m';
Pur='\e[0;35m';     BPur='\e[1;35m';    UPur='\e[4;35m';    IPur='\e[0;95m';    BIPur='\e[1;95m';   On_Pur='\e[45m';    On_IPur='\e[0;105m';
Cya='\e[0;36m';     BCya='\e[1;36m';    UCya='\e[4;36m';    ICya='\e[0;96m';    BICya='\e[1;96m';   On_Cya='\e[46m';    On_ICya='\e[0;106m';
Whi='\e[0;37m';     BWhi='\e[1;37m';    UWhi='\e[4;37m';    IWhi='\e[0;97m';    BIWhi='\e[1;97m';   On_Whi='\e[47m';    On_IWhi='\e[0;107m';

echo "----------"
echo `date`
if [[ -n $(which fortune) ]]
then
	fortune -sn 70
fi

# colours
lt='\e[1;36m' # light cyan
dk='\e[0;36m' # dark cyan
tx='\e[1;32m' # green text
ec='\e[0m'

# details
echo -n "-"
machine=$(</proc/sys/kernel/hostname)
echo -n "-"
arch=$(uname -m)
echo -n "-"
mykernel=$(uname -r)
echo -n "-"
mycpu=$(grep -m1 "model name" /proc/cpuinfo | cut -d':' -f2 | sed -r 's/(Intel\(R\)|CPU|@|\s+)/ /g' | sed -r 's/\s+/ /g' | sed -r 's/^\s+//')
echo -n "-"
myshell=$(ps -p `ps -p $$ -o ppid=` | sed -n '2p' | sed -r 's/.*\s(.*)$/\1/')
echo -n "-"
mymem=$(free -h --si | sed -n '2p' | sed -r 's/\s+/ /g' | cut -d' ' -f2)
echo -n "-"
myip=$(ip route show | tail -n1 | sed -r 's/.*src(.*)/\1/' | cut -d' ' -f2)
echo -n "-"
mypackages=$(pacman -Qet | wc -l)
echo -n "-"

# get uptime
ups=$(cat /proc/uptime | cut -d. -f1)
echo -n "-"
upm=$(( $ups / 60 ))
uph=$(( $upm / 60 ))
upd=$(( $uph / 24 ))
if [ "$upm" != 0 ]; then ups=$(( $ups - $upm*60 )); fi
if [ "$uph" != 0 ]; then upm=$(( $upm - $uph*60 )); fi
if [ "$upd" != 0 ]; then uph=$(( $uph - $upd*24 )); fi
if [ "$ups" -lt 10 ]; then ups=$( echo "0$ups"); fi
if [ "$upm" -lt 10 ]; then upm=$( echo "0$upm"); fi

if [ "$upd" != 0 ]
then
	if [ "$upd" < 10 ]
	then
		myuptime=$(echo "$upd day, $uph:$upm:$ups")
	else
		myuptime=$(echo "$upd days, $uph:$upm:$ups")
	fi
else
	myuptime=$(echo "$uph:$upm:$ups")
fi


########

mydev1_data=$(df -h | grep -E "^/dev/" | sed -n "1p" | sed -r 's/\s+/ /g')
mydev2_data=$(df -h | grep -E "^/dev/" | sed -n "2p" | sed -r 's/\s+/ /g')
mydev3_data=$(df -h | grep -E "^/dev/" | sed -n "3p" | sed -r 's/\s+/ /g')
mydev4_data=$(df -h | grep -E "^/dev/" | sed -n "4p" | sed -r 's/\s+/ /g')

mydev1_name=$(echo $mydev1_data | cut -d' ' -f1)
mydev2_name=$(echo $mydev2_data | cut -d' ' -f1)
mydev3_name=$(echo $mydev3_data | cut -d' ' -f1)
mydev4_name=$(echo $mydev4_data | cut -d' ' -f1)

mydev1_avail=$(echo $mydev1_data | cut -d' ' -f4)
mydev2_avail=$(echo $mydev2_data | cut -d' ' -f4)
mydev3_avail=$(echo $mydev3_data | cut -d' ' -f4)
mydev4_avail=$(echo $mydev4_data | cut -d' ' -f4)

mydev1_size=$(echo $mydev1_data | cut -d' ' -f2)
mydev2_size=$(echo $mydev2_data | cut -d' ' -f2)
mydev3_size=$(echo $mydev3_data | cut -d' ' -f2)
mydev4_size=$(echo $mydev4_data | cut -d' ' -f2)

if [[ $mydev1_name != '' ]]
then
	#mydev1=$(echo "$mydev1_name \t$mydev1_avail \t(used : $mydev1_percent)")
	mydev1=$(echo "$mydev1_name $mydev1_avail / $mydev1_size")
fi
if [[ $mydev2_name != '' ]]
then
	#mydev2=$(echo "$mydev2_name \t$mydev2_avail \t(used : $mydev2_percent)")
	mydev2=$(echo "$mydev2_name $mydev2_avail / $mydev2_size")
fi
if [[ $mydev3_name != '' ]]
then
	#mydev3=$(echo "$mydev3_name \t$mydev3_avail \t(used : $mydev3_percent)")
	mydev3=$(echo "$mydev3_name $mydev3_avail / $mydev3_size")
fi
if [[ $mydev4_name != '' ]]
then
	#mydev4=$(echo "$mydev4_name \t$mydev4_avail \t(used : $mydev4_percent)")
	mydev4=$(echo "$mydev4_name $mydev4_avail / $mydev4_size")
fi

echo -e "${dk}
                ._,.
          '..-..pf.
         -L   ..#'
       .+_L  .']#
       ,'j' .+.j'                 -'.__..,.,p. ${tx}Machine:${ec} ${machine}${dk}
      _~ #..<..0.                 .J-.''..._f. ${tx}Architecture:${ec} ${arch}${dk}
     .7..#_.. _f.                .....-..,'4'  ${tx}Kernel:${ec} ${mykernel}${dk}
     ;' ,#j.  T'      ..         ..J....,'.j'  ${tx}CPU:${ec} ${mycpu}${dk}
    .' ..'^.,-0.,,,,yMMMMM,.    ,-.J...+'.j@   ${tx}Memory:${ec} ${mymem^}${dk}
   .'.'...' .yMMMMM0M@^='''g.. .'..J..'.'.jH   ${tx}Uptime:${ec} ${myuptime}${dk}
   j' .'1'  q'^)@@#'^'.''='BNg_...,]_)'...0-   ${tx}Shell:${ec} ${myshell^}${dk}
  .T ...I. j'    .'..+,_.'3#MMM0MggCBf....F.   ${tx}IP:${ec} ${myip}${dk}
  j/.+'.{..+       '^~'-^~~''''''''?'''''1'    ${tx}Packages:${ec} ${mypackages^}${dk} 
  .... .y.}                  '.._-:'_...jf     
  g-.  .Lg'                 ..,..'-....,'.
 .'.   .Y^                  .....',].._f
 ......-f.                 .-,,.,.-:--&'       ${tx}Storage:${ec}${dk} 
                           .'...'..'_J'        ${ec}${mydev1}${dk}
                           .~......'#'         ${ec}${mydev2}${dk}
                           '..,,.,_]'          ${ec}${mydev3}${dk}
                           .L..'..''.          ${ec}${mydev4}${dk}
${ec}"
